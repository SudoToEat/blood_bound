# 鲜血盟约 (Blood Bound)

一个基于网页的"鲜血盟约"桌游辅助工具，支持多设备同时访问，实时同步游戏状态。

## 🎮 游戏简介

"鲜血盟约"是一款社交推理桌游，玩家分为凤凰氏族、石像鬼氏族和中立角色，通过策略和推理来获得胜利。本工具为游戏提供数字化支持，方便玩家查看身份、管理游戏状态。

## ✨ 功能特性

### 核心功能
- ✅ **多设备同时访问** - 支持不同浏览器/设备同时参与游戏
- ✅ **实时同步** - WebSocket实时同步游戏状态
- ✅ **房间管理** - 自动房间创建和玩家管理
- ✅ **身份系统** - 自动分配和显示玩家身份
- ✅ **二维码访问** - 玩家可通过扫描二维码快速加入

### 辅助功能
- ✅ **连接监控** - 实时显示连接状态和玩家在线情况
- ✅ **房间号显示** - 主持人和玩家页面均显示当前房间号
- ✅ **揭示所有身份** - 主持人可一键揭示/隐藏所有玩家身份和诅咒信息
- ✅ **伤害跟踪** - 记录玩家受伤情况（展示线索）
- ✅ **能力卡管理** - 管理长剑、折扇、法杖、盾牌等能力卡
- ✅ **诅咒卡系统** - 调查官分配真假诅咒卡
- ✅ **Toast通知** - 优雅的操作反馈提示
- ✅ **错误处理** - 完善的错误边界和日志系统

### 用户体验
- ✅ **响应式设计** - 支持手机、平板和桌面设备
- ✅ **角色图鉴** - 完整的角色介绍和技能说明
- ✅ **自动清理** - 自动清理过期房间和断线玩家
- ✅ **姓名编辑** - 玩家可自定义显示姓名

## 🚀 快速开始

### 开发环境

```bash
# 1. 安装依赖
npm install

# 2. 一键启动 (推荐)
npm run dev:full

# 或者分别启动
npm run server        # 后端服务 (端口3000)
npm run dev           # 前端服务 (端口5173)
```

### 访问地址

- **开发环境**:
  - 前端: http://localhost:5173
  - 后端API: http://localhost:3000
  - 局域网访问: http://[你的IP]:5173 (如 http://192.168.1.100:5173)

### 使用流程

1. **主持人创建房间**
   - 访问主页 http://localhost:5173
   - 选择玩家数量 (6-12人)
   - 点击"创建房间"
   - 获得房间号和每个玩家的二维码

2. **玩家加入游戏**
   - 扫描对应玩家编号的二维码
   - 或访问链接 `/access/[房间号]/[玩家ID]`
   - 自动连接到房间并查看个人身份

3. **开始游戏**
   - 主持人监控玩家加入情况
   - 点击"进入游戏面板"查看所有玩家状态
   - 实时同步游戏进程

## 🎯 角色系统

### 阵营分配
- **凤凰氏族（红色）**: 长老、刺客、弄臣、炼金术士、灵谕师
- **石像鬼氏族（蓝色）**: 卫士、狂战士、法师、舞妓
- **中立**: 调查官

### 角色列表

| 等级 | 角色名 | 阵营 | 能力描述 |
|-----|--------|------|----------|
| 1 | 长老 | 凤凰氏族 | 可以使用鹅毛笔能力，将数字最大的角色变成氏族族长 |
| 2 | 刺客 | 凤凰氏族 | 让任意一位玩家受两点伤害，然后将匕首交给该玩家 |
| 3 | 弄臣 | 凤凰氏族 | 选择两位玩家，私下查看他们的角色阵营身份。弄臣右下角的阵营线索和实际阵营相反 |
| 4 | 炼金术士 | 凤凰氏族 | 【干涉】一名玩家，并可以选择治愈一点或是伤害一点被干涉的玩家 |
| 5 | 灵谕师 | 凤凰氏族 | 强制任何一位玩家受到一点伤害，并把匕首交给该玩家。被灵谕师能力伤害的玩家无法发动角色能力 |
| 6 | 卫士 | 石像鬼氏族 | 将盾牌卡给予任意玩家，并把长剑卡放在自己桌面上 |
| 7 | 狂战士 | 石像鬼氏族 | 强制让刚才攻击他的玩家受一点伤害 |
| 8 | 法师 | 石像鬼氏族 | 将法杖卡给自己和任意一位玩家。有法杖卡的玩家拿阵营指示物时，只能拿未知阵营指示物 |
| 9 | 舞妓 | 石像鬼氏族 | 将折扇卡给任意一位玩家，有折扇卡的玩家，无法让其他玩家进行干涉 |
| 10 | 调查官 | 中立 | 中立角色。不可以攻击已经受伤三点的玩家。受伤时可以拿任意种类的阵营指示物。如果被杀掉则单独获胜 |

### 能力卡说明
- **长剑**: 进行攻击的基本武器
- **匕首**: 刺客和灵谕师使用后交给目标
- **盾牌**: 保护玩家免受攻击和能力伤害
- **折扇**: 防止被其他玩家干涉
- **法杖**: 限制只能拿未知阵营指示物
- **鹅毛笔**: 长老使用，指定新的氏族族长

### 诅咒卡系统
调查官可以分配诅咒卡：
- **7人局**: 1张真诅咒 + 1张假诅咒
- **9人局**: 1张真诅咒 + 2张假诅咒
- **11人局**: 1张真诅咒 + 3张假诅咒

如果将真诅咒卡给最终获胜的氏族族长，调查官单独获得胜利。

## 📁 项目结构

```
bloodbond/
├── server/                    # 后端服务
│   └── index.js              # Express + Socket.IO 服务器
├── src/
│   ├── components/           # React 组件
│   │   ├── GameBoard.tsx    # 主持人游戏面板
│   │   ├── PlayerAccess.tsx # 玩家访问页面
│   │   ├── PlayerView.tsx   # 玩家身份视图
│   │   ├── PlayerCard.tsx   # 玩家卡片
│   │   ├── RoomSetup.tsx    # 房间设置
│   │   ├── QRCodeDisplay.tsx # 二维码显示
│   │   ├── RulesModal.tsx   # 规则查看
│   │   ├── ConnectionStatusBar.tsx # 连接状态栏
│   │   ├── ErrorBoundary.tsx # 错误边界
│   │   └── ui/              # UI 组件
│   │       ├── Toast.tsx    # Toast 通知
│   │       └── LoadingSpinner.tsx # 加载动画
│   ├── context/             # 状态管理
│   │   ├── GameContext.tsx  # 游戏上下文
│   │   └── ToastContext.tsx # Toast 上下文
│   ├── utils/               # 工具函数
│   │   ├── apiService.ts    # API 服务
│   │   ├── socketService.ts # WebSocket 服务
│   │   ├── gameUtils.ts     # 游戏工具
│   │   └── logger.ts        # 日志工具
│   ├── types/               # TypeScript 类型
│   │   └── gameTypes.ts     # 游戏类型定义
│   └── assets/              # 静态资源
│       └── characters/      # 角色图片
└── docs/                    # 文档
    ├── QUICK_START.md       # 快速开始指南
    ├── README_MOBILE.md     # 移动端说明
    └── README_MULTI_BROWSER.md # 多浏览器说明
```

## 🔧 技术栈

### 前端
- **React 18** - 用户界面框架
- **TypeScript** - 类型安全
- **Vite** - 构建工具
- **Tailwind CSS** - 样式框架
- **Socket.IO Client** - 实时通信
- **React Router** - 路由管理
- **qrcode** - 二维码生成

### 后端
- **Node.js** - 运行环境
- **Express** - Web 框架
- **Socket.IO** - WebSocket 服务
- **CORS** - 跨域支持

## 🌐 网络配置

### 局域网访问配置

1. **获取本机IP地址**:
   ```bash
   # Windows
   ipconfig

   # Mac/Linux
   ifconfig
   ```

2. **配置Vite** (已配置):
   ```typescript
   // vite.config.ts
   server: {
     host: '0.0.0.0',  // 允许局域网访问
     port: 5173
   }
   ```

3. **访问地址**:
   - 主持人: `http://[本机IP]:5173`
   - 玩家: 扫描二维码或使用主持人提供的链接

### 防火墙设置
确保开放以下端口：
- **3000**: 后端API和WebSocket
- **5173**: 前端开发服务器

## 🐛 故障排除

### 常见问题

1. **无法连接服务器**
   ```bash
   # 检查服务器是否运行
   curl http://localhost:3000/api/health
   ```
   - 确认端口3000未被占用
   - 检查防火墙设置

2. **玩家无法加入房间**
   - 确认房间号正确
   - 检查网络连接（所有设备需在同一网络）
   - 查看浏览器控制台错误

3. **实时同步不工作**
   - 检查WebSocket连接（浏览器控制台 Network 标签）
   - 确认浏览器支持WebSocket
   - 查看连接状态栏提示

4. **二维码扫描失败**
   - 提高屏幕亮度
   - 尝试使用"复制链接"功能
   - 确保二维码完整显示

### 调试工具

- **服务器健康检查**: http://localhost:3000/api/health
- **浏览器控制台**: F12 查看详细日志
- **网络面板**: 检查API和WebSocket通信

## 📚 相关文档

- [快速使用指南](QUICK_START.md) - 5分钟快速上手
- [移动端使用指南](README_MOBILE.md) - 手机端访问说明
- [多浏览器版本说明](README_MULTI_BROWSER.md) - 详细的技术文档
- [角色图片说明](CHARACTER_IMAGES_SUMMARY.md) - 角色图片系统
- [官方游戏规则](https://andyventure.com/boardgame-blood-bound/) - 完整游戏规则

## 🔄 更新日志

### v2.0.0 (2025-01) - 重大更新
- ✅ 添加房间号显示功能
- ✅ 实现揭示所有身份功能
- ✅ 集成Toast通知系统
- ✅ 添加环境感知日志系统
- ✅ 统一LoadingSpinner组件
- ✅ 优化连接状态检测
- ✅ 修复emoji显示

### v1.5.0 (2024-12)
- ✅ 实现WebSocket实时同步
- ✅ 添加房间管理API
- ✅ 支持多设备同时访问
- ✅ 添加连接状态监控

### v1.0.0 (2024-11)
- ✅ 基础游戏功能
- ✅ 角色系统实现
- ✅ 单机版本

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License
